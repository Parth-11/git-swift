diff --git a/.gitignore b/.gitignore
index ea8c4bf..fedaa2b 100644
--- a/.gitignore
+++ b/.gitignore
@@ -1 +1,2 @@
 /target
+.env
diff --git a/Cargo.lock b/Cargo.lock
index eb25dd0..786447b 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -112,6 +112,12 @@ dependencies = [
  "syn",
 ]
 
+[[package]]
+name = "dotenv"
+version = "0.15.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "77c90badedccf4105eca100756a0b1289e191f6fcbdadd3cee1d2f614f97da8f"
+
 [[package]]
 name = "encoding_rs"
 version = "0.8.35"
@@ -212,6 +218,18 @@ dependencies = [
  "pin-utils",
 ]
 
+[[package]]
+name = "gemini-rs"
+version = "0.4.2"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "f8bcddea0b28e3220824683f6e622d2ffb4cb234e9a6edd2a3cfa6840c99244b"
+dependencies = [
+ "json",
+ "reqwest",
+ "thiserror",
+ "tokio",
+]
+
 [[package]]
 name = "getrandom"
 version = "0.2.15"
@@ -233,10 +251,11 @@ checksum = "07e28edb80900c19c28f1072f2e8aeca7fa06b23cd4169cefe1af5aa3260783f"
 name = "git-swift"
 version = "0.1.0"
 dependencies = [
+ "dotenv",
+ "gemini-rs",
  "git2",
  "reqwest",
- "serde",
- "serde_json",
+ "tokio",
 ]
 
 [[package]]
@@ -571,6 +590,12 @@ dependencies = [
  "wasm-bindgen",
 ]
 
+[[package]]
+name = "json"
+version = "0.12.4"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "078e285eafdfb6c4b434e0d31e8cfcb5115b651496faca5749b88fafd4f23bfd"
+
 [[package]]
 name = "libc"
 version = "0.2.169"
@@ -629,6 +654,16 @@ version = "0.7.4"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "4ee93343901ab17bd981295f2cf0026d4ad018c7c31ba84549a4ddbb47a45104"
 
+[[package]]
+name = "lock_api"
+version = "0.4.12"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "07af8b9cdd281b7915f413fa73f29ebd5d55d0d3f0155584dade1ff18cea1b17"
+dependencies = [
+ "autocfg",
+ "scopeguard",
+]
+
 [[package]]
 name = "log"
 version = "0.4.22"
@@ -743,6 +778,29 @@ dependencies = [
  "vcpkg",
 ]
 
+[[package]]
+name = "parking_lot"
+version = "0.12.3"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "f1bf18183cf54e8d6059647fc3063646a1801cf30896933ec2311622cc4b9a27"
+dependencies = [
+ "lock_api",
+ "parking_lot_core",
+]
+
+[[package]]
+name = "parking_lot_core"
+version = "0.9.10"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "1e401f977ab385c9e4e3ab30627d6f26d00e2c73eef317493c4ec6d468726cf8"
+dependencies = [
+ "cfg-if",
+ "libc",
+ "redox_syscall",
+ "smallvec",
+ "windows-targets",
+]
+
 [[package]]
 name = "percent-encoding"
 version = "2.3.1"
@@ -785,6 +843,15 @@ dependencies = [
  "proc-macro2",
 ]
 
+[[package]]
+name = "redox_syscall"
+version = "0.5.8"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "03a862b389f93e68874fbf580b9de08dd02facb9a788ebadaf4a3fd33cf58834"
+dependencies = [
+ "bitflags",
+]
+
 [[package]]
 name = "reqwest"
 version = "0.12.12"
@@ -917,6 +984,12 @@ dependencies = [
  "windows-sys 0.59.0",
 ]
 
+[[package]]
+name = "scopeguard"
+version = "1.2.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "94143f37725109f92c262ed2cf5e59bce7498c01bcc1502d7b9afe439a4e9f49"
+
 [[package]]
 name = "security-framework"
 version = "2.11.1"
@@ -990,6 +1063,15 @@ version = "1.3.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "0fda2ff0d084019ba4d7c6f371c95d8fd75ce3524c3cb8fb653a3023f6323e64"
 
+[[package]]
+name = "signal-hook-registry"
+version = "1.4.2"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "a9e9e0b4211b72e7b8b6e85c807d36c212bdb33ea8587f7569562a84df5465b1"
+dependencies = [
+ "libc",
+]
+
 [[package]]
 name = "slab"
 version = "0.4.9"
@@ -1099,6 +1181,26 @@ dependencies = [
  "windows-sys 0.59.0",
 ]
 
+[[package]]
+name = "thiserror"
+version = "1.0.69"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "b6aaf5339b578ea85b50e080feb250a3e8ae8cfcdff9a461c9ec2904bc923f52"
+dependencies = [
+ "thiserror-impl",
+]
+
+[[package]]
+name = "thiserror-impl"
+version = "1.0.69"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "4fee6c4efc90059e10f81e6d42c60a18f76588c3d74cb83a0b242a2b6c7504c1"
+dependencies = [
+ "proc-macro2",
+ "quote",
+ "syn",
+]
+
 [[package]]
 name = "tinystr"
 version = "0.7.6"
@@ -1119,11 +1221,25 @@ dependencies = [
  "bytes",
  "libc",
  "mio",
+ "parking_lot",
  "pin-project-lite",
+ "signal-hook-registry",
  "socket2",
+ "tokio-macros",
  "windows-sys 0.52.0",
 ]
 
+[[package]]
+name = "tokio-macros"
+version = "2.5.0"
+source = "registry+https://github.com/rust-lang/crates.io-index"
+checksum = "6e06d43f1345a3bcd39f6a56dbb7dcab2ba47e68e8ac134855e7e2bdbaf8cab8"
+dependencies = [
+ "proc-macro2",
+ "quote",
+ "syn",
+]
+
 [[package]]
 name = "tokio-native-tls"
 version = "0.3.1"
diff --git a/Cargo.toml b/Cargo.toml
index 2c04af9..79a6961 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -4,8 +4,8 @@ version = "0.1.0"
 edition = "2021"
 
 [dependencies]
+dotenv = "0.15.0"
+gemini-rs = "0.4.2"
 git2 = "0.20.0"
 reqwest = { version = "0.12.12", features = ["json"] }
-serde = { version="1.0.217", features = ["derive"] }
-serde_json = "1.0.135"
-# tokio = { version = "1.43.0", features = ["full"] }
+tokio = { version = "1.43.0", features = ["full"] }
diff --git a/git-swift b/git-swift
index e802da5..c9d548d 100755
Binary files a/git-swift and b/git-swift differ
diff --git a/src/main.rs b/src/main.rs
index 2c6f13b..f530646 100644
--- a/src/main.rs
+++ b/src/main.rs
@@ -1,8 +1,34 @@
+use dotenv::dotenv;
+use gemini_rs::Conversation;
 use git2::Repository;
+use std::env;
+
+async fn generate_commit_message(
+    diff: &str,
+    api_key: &str,
+) -> Result<String, Box<dyn std::error::Error + Send + Sync>> {
+    let mut convo = Conversation::new(api_key.to_string(), "gemini-1.5-flash".to_string());
+
+    let prompt = format!(
+        "Generate commit message from the whole diff: {}\n\n only return the commit message",
+        diff
+    );
+    let response = convo.prompt(&prompt).await;
+    Ok(response.trim().to_string())
+}
 
 fn get_diff(repo_path: &str) -> Result<String, git2::Error> {
     let repo = Repository::open(repo_path)?;
-    let head = repo.head()?;
+    let head = match repo.head() {
+        Ok(head) => head,
+        Err(e) => {
+            if e.code() == git2::ErrorCode::UnbornBranch {
+                return Ok(String::from("No commits in the repository"));
+            } else {
+                return Err(e);
+            }
+        }
+    };
     let head_commit = head.peel_to_commit()?;
     let tree = head_commit.tree()?;
 
@@ -17,11 +43,18 @@ fn get_diff(repo_path: &str) -> Result<String, git2::Error> {
 
     Ok(diff_str)
 }
-
-fn main() {
+#[tokio::main]
+async fn main() {
+    dotenv().ok();
     let repo_path = ".";
+    let api_key = env::var("GEMINI_API_KEY").expect("GEMINI_API_KEY must be set");
     match get_diff(repo_path) {
-        Ok(diff) => println!("diff: {}", diff),
+        Ok(diff) => match generate_commit_message(&diff, &api_key).await {
+            Ok(commit_message) => println!("Commit Message: {}", commit_message),
+            Err(e) => eprintln!("Failed to generate commit message: {}", e),
+        },
+
         Err(e) => println!("Error: {}", e),
     }
+    println!("")
 }
